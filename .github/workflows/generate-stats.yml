name: Generate Custom Profile Stats

on:
  schedule:
    - cron: "0 3 * * *"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Create assets folder
        run: mkdir -p assets

      - name: Generate BOTH SVG files
        run: |
          node - << 'EOF'
          const fs = require('fs');

          const today = new Date().toLocaleDateString("it-IT");

          // ---------- 1) STATS.SVG ----------
          const statsSvg = `
          <svg width="500" height="160" xmlns="http://www.w3.org/2000/svg">
            <rect width="500" height="160" rx="15" fill="#0A0F1F"/>
            <text x="20" y="40" fill="#4CAF50" font-size="22">
              SimplyPowfu — GitHub Stats
            </text>
            <text x="20" y="75" fill="white" font-size="16">
              • Repo pubblici:  (auto in futuro)
            </text>
            <text x="20" y="100" fill="white" font-size="16">
              • Stelle totali:  (auto in futuro)
            </text>
            <text x="20" y="125" fill="white" font-size="16">
              • Ultimo update: ${today}
            </text>
          </svg>
          `;

          fs.writeFileSync('assets/stats.svg', statsSvg);

          // ---------- 2) TOP-LANGS.SVG ----------
          const topLangsSvg = `
          <svg width="500" height="200" xmlns="http://www.w3.org/2000/svg">
            <rect width="500" height="200" rx="15" fill="#0A0F1F"/>

            <text x="20" y="40" fill="#4CAF50" font-size="22">
              Top Languages — SimplyPowfu
            </text>

            <text x="20" y="75" fill="white" font-size="16">C</text>
            <rect x="180" y="60" width="250" height="15" rx="7" fill="#4CAF50"/>

            <text x="20" y="105" fill="white" font-size="16">C++</text>
            <rect x="180" y="90" width="180" height="15" rx="7" fill="#4CAF50"/>

            <text x="20" y="135" fill="white" font-size="16">Python</text>
            <rect x="180" y="120" width="120" height="15" rx="7" fill="#4CAF50"/>

            <text x="20" y="175" fill="#AAAAAA" font-size="12">
              Aggiornato: ${today}
            </text>
          </svg>
          `;

          fs.writeFileSync('assets/top-langs.svg', topLangsSvg);

          EOF

      - name: Commit and push
        run: |
          git config --global user.name "github-bot"
          git config --global user.email "bot@github.com"
          git add assets/*.svg
          git commit -m "Update custom profile widgets" || echo "No changes"
          git push
